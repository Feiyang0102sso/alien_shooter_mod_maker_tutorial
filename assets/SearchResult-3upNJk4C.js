import{j as V,m as W,p as X,q as Z,s as ee,v as ae,x as se,k as L,y as H,l as e,z as le,A as te,B as re,R as E,C as ie,D as oe,E as ue,G as ce,H as ne,I as F,J as I,K as de,L as he,M as me,o as ve,N as pe,O as ye,P as ge,Q as ze,S as j,T as be,U as k}from"./app-BTK9GB7I.js";const fe=["/","/portfolio.html","/demo/","/demo/disable.html","/demo/layout.html","/demo/markdown.html","/demo/page.html","/en/","/guide/","/zh/","/zh/portfolio.html","/guide/bar/","/guide/bar/baz.html","/guide/foo/","/guide/foo/ray.html","/zh/as1/","/zh/as2/","/zh/download/","/zh/demo/","/zh/demo/disable.html","/zh/demo/layout.html","/zh/demo/markdown.html","/zh/demo/page.html","/zh/guide/","/zh/as1/map-editor/","/zh/as1/map-editor/as_me_build.html","/zh/as1/map-editor/as_me_launch.html","/zh/as2/lgc_script/","/zh/as2/lgc_script/lgc_basic_quest.html","/zh/as2/lgc_script/lgc_delayed_teleport.html","/zh/as2/map-editor/","/zh/as2/map-editor/me_basic_enemy_generator.html","/zh/as2/map-editor/me_basic_mask.html","/zh/as2/map-editor/me_basic_npc.html","/zh/as2/map-editor/me_basic_teleport.html","/zh/as2/quest_editor/","/zh/as2/quest_editor/quest_editor.html","/zh/guide/bar/","/zh/guide/bar/baz.html","/zh/guide/foo/","/zh/guide/foo/ray.html","/404.html"],_e="SLIMSEARCH_QUERY_HISTORY",g=j(_e,[]),He=()=>{const{queryHistoryCount:t}=k;return{enabled:t>0,queryHistories:g,addQueryHistory:u=>{g.value=Array.from(new Set([u,...g.value.slice(0,t-1)]))},removeQueryHistory:u=>{g.value=[...g.value.slice(0,u),...g.value.slice(u+1)]}}},C=t=>fe[t.id]+("anchor"in t?`#${t.anchor}`:""),ke="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:T}=k,z=j(ke,[]),qe=()=>({enabled:T>0,resultHistories:z,addResultHistory:o=>{{const u={link:C(o),display:o.display};"header"in o&&(u.header=o.header),z.value=[u,...z.value.slice(0,T-1)]}},removeResultHistory:o=>{z.value=[...z.value.slice(0,o),...z.value.slice(o+1)]}}),we=t=>{const{page:o,routeLocale:u}=de(),q=he(),r=L(0),b=H(()=>r.value>0),d=me([]);return ve(()=>{const{search:w,terminate:v}=pe(),f=ge(p=>{const{resultsFilter:x=l=>l,querySplitter:y,suggestionsFilter:D,...i}=q.value;p?(r.value+=1,w(p,u.value,i).then(l=>x(l,p,u.value,o.value)).then(l=>{r.value-=1,d.value=l}).catch(l=>{console.warn(l),r.value-=1,r.value||(d.value=[])})):d.value=[]},k.searchDelay-k.suggestDelay,{maxWait:5e3});ye([t,u],([p])=>f(p.join(" "))),ze(()=>{v()})}),{isSearching:b,results:d}};var Qe=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:o}){const u=W(),q=X(),r=Z(ee),{addQueryHistory:b,queryHistories:d,removeQueryHistory:w}=He(),{resultHistories:v,addResultHistory:f,removeResultHistory:p}=qe(),x=ae(t,"queries"),{results:y,isSearching:D}=we(x),i=se({isQuery:!0,index:0}),l=L(0),h=L(0),$=H(()=>d.value.length>0||v.value.length>0),Q=H(()=>y.value.length>0),R=H(()=>y.value[l.value]||null),M=()=>{const{isQuery:a,index:s}=i;s===0?(i.isQuery=!a,i.index=a?v.value.length-1:d.value.length-1):i.index=s-1},U=()=>{const{isQuery:a,index:s}=i;s===(a?d.value.length-1:v.value.length-1)?(i.isQuery=!a,i.index=0):i.index=s+1},O=()=>{l.value=l.value>0?l.value-1:y.value.length-1,h.value=R.value.contents.length-1},P=()=>{l.value=l.value<y.value.length-1?l.value+1:0,h.value=0},Y=()=>{h.value<R.value.contents.length-1?h.value+=1:P()},B=()=>{h.value>0?h.value-=1:O()},S=a=>a.map(s=>be(s)?s:e(s[0],s[1])),G=a=>{if(a.type==="customField"){const s=ce[a.index]||"$content",[m,c=""]=ne(s)?s[q.value].split("$content"):s.split("$content");return a.display.map(n=>e("div",S([m,...n,c])))}return a.display.map(s=>e("div",S(s)))},_=()=>{l.value=0,h.value=0,o("updateQuery",""),o("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((a,s)=>{const m=i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{o("updateQuery",a)}},e("div",[e(F,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},a),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),w(s)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((a,s)=>{const m=!i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e(E,{to:a.link,onClick:()=>{_()}},()=>[e(F,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[a.header?e("div",{class:"slimsearch-record-content-header"},a.header):null,e("div",a.display.map(c=>S(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),p(s)}})]))}))]));return le("keydown",a=>{if(t.isFocusing){if(Q.value){if(a.key==="ArrowUp")B();else if(a.key==="ArrowDown")Y();else if(a.key==="Enter"){const s=R.value.contents[h.value];b(t.queries.join(" ")),f(s),u.push(C(s)),_()}}else if(a.key==="ArrowUp")M();else if(a.key==="ArrowDown")U();else if(a.key==="Enter"){const{index:s}=i;i.isQuery?(a.preventDefault(),o("updateQuery",d.value[s])):(u.push(v.value[s].link),_())}}}),te([l,h],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!Q.value:!$.value}]},t.queries.length?D.value?e(re,{hint:r.value.searching}):Q.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},y.value.map(({title:a,contents:s},m)=>{const c=l.value===m;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},a||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},s.map((n,N)=>{const A=c&&h.value===N;return e("li",{class:["slimsearch-record-matches",{active:A}],role:"option","aria-selected":A},e(E,{to:C(n),onClick:()=>{b(t.queries.join(" ")),f(n),_()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ue,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):r.value.emptyResult:$.value?[J(),K()]:r.value.emptyHistory)}});export{Qe as default};
