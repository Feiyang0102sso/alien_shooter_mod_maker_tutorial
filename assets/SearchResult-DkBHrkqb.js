import{j as K,z as N,A as X,B as Z,C as ee,D as se,E as ae,k as L,s as H,l as e,G as le,y as te,H as re,R as E,I as ie,J as oe,K as ue,L as ce,M as ne,N as F,O as I,P as de,Q as he,S as me,o as ve,U as pe,V as ye,W as ge,q as _e,X as j,Y as fe,Z as k}from"./app-Dmwpjhax.js";const be=["/","/portfolio.html","/demo/","/demo/disable.html","/demo/layout.html","/demo/markdown.html","/demo/page.html","/en/","/guide/","/zh/","/guide/bar/","/guide/bar/baz.html","/guide/foo/","/guide/foo/ray.html","/zh/as1/","/zh/as2/","/zh/download/","/zh/universal/","/zh/universal/command.html","/zh/vid_file/","/zh/vid_file/exp1_single.html","/zh/vid_file/exp2_multi.html","/zh/vid_file/exp3_ani.html","/zh/vid_file/install_3ds_max_2011.html","/zh/as1/map-editor/","/zh/as1/map-editor/as_me_build.html","/zh/as1/map-editor/as_me_launch.html","/zh/as2/lgc_script/","/zh/as2/lgc_script/lgc_basic_quest.html","/zh/as2/lgc_script/lgc_delayed_teleport.html","/zh/as2/map-editor/","/zh/as2/map-editor/me_basic_enemy_generator.html","/zh/as2/map-editor/me_basic_mask.html","/zh/as2/map-editor/me_basic_npc.html","/zh/as2/map-editor/me_basic_teleport.html","/zh/as2/quest_editor/","/zh/as2/quest_editor/quest_editor.html","/404.html"],ze="SLIMSEARCH_QUERY_HISTORY",g=j(ze,[]),He=()=>{const{queryHistoryCount:t}=k;return{enabled:t>0,queryHistories:g,addQueryHistory:u=>{g.value=Array.from(new Set([u,...g.value.slice(0,t-1)]))},removeQueryHistory:u=>{g.value=[...g.value.slice(0,u),...g.value.slice(u+1)]}}},C=t=>be[t.id]+("anchor"in t?`#${t.anchor}`:""),ke="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:T}=k,_=j(ke,[]),xe=()=>({enabled:T>0,resultHistories:_,addResultHistory:o=>{{const u={link:C(o),display:o.display};"header"in o&&(u.header=o.header),_.value=[u,..._.value.slice(0,T-1)]}},removeResultHistory:o=>{_.value=[..._.value.slice(0,o),..._.value.slice(o+1)]}}),qe=t=>{const{page:o,routeLocale:u}=de(),x=he(),r=L(0),f=H(()=>r.value>0),d=me([]);return ve(()=>{const{search:q,terminate:v}=pe(),b=ge(p=>{const{resultsFilter:w=l=>l,querySplitter:y,suggestionsFilter:D,...i}=x.value;p?(r.value+=1,q(p,u.value,i).then(l=>w(l,p,u.value,o.value)).then(l=>{r.value-=1,d.value=l}).catch(l=>{console.warn(l),r.value-=1,r.value||(d.value=[])})):d.value=[]},k.searchDelay-k.suggestDelay,{maxWait:5e3});ye([t,u],([p])=>b(p.join(" "))),_e(()=>{v()})}),{isSearching:f,results:d}};var Qe=K({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:o}){const u=N(),x=X(),r=Z(ee),{addQueryHistory:f,queryHistories:d,removeQueryHistory:q}=He(),{resultHistories:v,addResultHistory:b,removeResultHistory:p}=xe(),w=se(t,"queries"),{results:y,isSearching:D}=qe(w),i=ae({isQuery:!0,index:0}),l=L(0),h=L(0),$=H(()=>d.value.length>0||v.value.length>0),Q=H(()=>y.value.length>0),R=H(()=>y.value[l.value]||null),M=()=>{const{isQuery:s,index:a}=i;a===0?(i.isQuery=!s,i.index=s?v.value.length-1:d.value.length-1):i.index=a-1},U=()=>{const{isQuery:s,index:a}=i;a===(s?d.value.length-1:v.value.length-1)?(i.isQuery=!s,i.index=0):i.index=a+1},O=()=>{l.value=l.value>0?l.value-1:y.value.length-1,h.value=R.value.contents.length-1},P=()=>{l.value=l.value<y.value.length-1?l.value+1:0,h.value=0},Y=()=>{h.value<R.value.contents.length-1?h.value+=1:P()},B=()=>{h.value>0?h.value-=1:O()},S=s=>s.map(a=>fe(a)?a:e(a[0],a[1])),V=s=>{if(s.type==="customField"){const a=ce[s.index]||"$content",[m,c=""]=ne(a)?a[x.value].split("$content"):a.split("$content");return s.display.map(n=>e("div",S([m,...n,c])))}return s.display.map(a=>e("div",S(a)))},z=()=>{l.value=0,h.value=0,o("updateQuery",""),o("close")},W=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((s,a)=>{const m=i.isQuery&&i.index===a;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{o("updateQuery",s)}},e("div",[e(F,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),q(a)}})]))}))])),G=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((s,a)=>{const m=!i.isQuery&&i.index===a;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e(E,{to:s.link,onClick:()=>{z()}},()=>[e(F,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(c=>S(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),p(a)}})]))}))]));return le("keydown",s=>{if(t.isFocusing){if(Q.value){if(s.key==="ArrowUp")B();else if(s.key==="ArrowDown")Y();else if(s.key==="Enter"){const a=R.value.contents[h.value];f(t.queries.join(" ")),b(a),u.push(C(a)),z()}}else if(s.key==="ArrowUp")M();else if(s.key==="ArrowDown")U();else if(s.key==="Enter"){const{index:a}=i;i.isQuery?(s.preventDefault(),o("updateQuery",d.value[a])):(u.push(v.value[a].link),z())}}}),te([l,h],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!Q.value:!$.value}]},t.queries.length?D.value?e(re,{hint:r.value.searching}):Q.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},y.value.map(({title:s,contents:a},m)=>{const c=l.value===m;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},s||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},a.map((n,J)=>{const A=c&&h.value===J;return e("li",{class:["slimsearch-record-matches",{active:A}],role:"option","aria-selected":A},e(E,{to:C(n),onClick:()=>{f(t.queries.join(" ")),b(n),z()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ue,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",V(n))])]))}))])})):r.value.emptyResult:$.value?[W(),G()]:r.value.emptyHistory)}});export{Qe as default};
